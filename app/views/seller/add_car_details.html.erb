<style>
.quote-imgs-thumbs {
  background: #eee;
  border: 1px solid #ccc;
  border-radius: 0.25rem;
  margin: 1.5rem 0;
  padding: 0.75rem;
  display: flex;
}
.fa-trash:hover{
  color:red;
  cursor:pointer;
}
.quote-imgs-thumbs--hidden {
  display: none;
}
.img-preview-thumb {
  background: #fff;
  border: 1px solid #777;
  border-radius: 0.25rem;
  box-shadow: 0.125rem 0.125rem 0.0625rem rgba(0, 0, 0, 0.12);
  margin-right: 1rem;
  max-width: 140px;
  padding: 0.25rem;
}
</style>
<div class="container">
<nav class="car-details p-4">
<div><a class="p-3"></a></div>
</nav>
<div>
 <%=form_with url: create_seller_appointment_path, method: :post  do |f|%>
  <%=f.text_field :user_id, value: current_user.id, hidden: "true"%>
  <div class="d-flex flex-wrap">
  <div>
  <%=f.label 'choose the brand'%>
  <%= select_tag(:brand_id, options_for_select(@brands), class:"custom-select custom-select-lg mb-3") %>
  </div>
  <div>
  <%=f.label 'choose cities'%>
  <%=select_tag(:city_id, options_for_select(@cities), class:"custom-select custom-select-lg mb-3") %>
  </div>
  <div>
  <%=f.label 'choose the range'%>
  <%=select_tag(:killometer_driven_id, options_for_select(@killometer_drivens), class:"custom-select custom-select-lg mb-3") %>
  </div> 
  <div>
  <%=f.label 'choose the registered state code'%>
  <%=select_tag(:car_registration_id, options_for_select(@car_registrations), class:"custom-select custom-select-lg mb-3") %>
  </div>
  <div>
  <%=f.label 'choose the type'%>
  <%=select_tag(:car_variant_id, options_for_select(@car_variants), class:"custom-select custom-select-lg mb-3") %>
  </div>
  <div>
  <%=f.label 'choose the model'%>
  <%=select_tag(:car_model_id, options_for_select(@car_models), class:"custom-select custom-select-lg mb-3") %>
  </div>
  </div>

  <div class="form-group">
   <%=f.label "description"%>
   <%=f.text_area :description, class:"form-control", id: "description"%>
  </div>

  <div class="form-group field">
   <%=f.label "expected price"%>
   <%=f.number_field :price ,required: true, class: "form-control" %>
  </div>

  <div class="form-group field" id="uio">
  <%=f.file_field :upload_imgs, id: "upload_imgs", multiple: true, name: 'images[]', class:"show-for-sr", hidden: true%>
  <button class="btn btn-primary" id="upload-btn">add images<i class="fa fa-plus"></i></button>
  </div>
  <div class="quote-imgs-thumbs quote-imgs-thumbs--hidden" id="img_preview" aria-live="polite"></div>
  </div>
  <div class="form-group">
  <%=f.text_field :location, id: :location, class: "form-control"%>
  </div>

  <%= f.text_field :longitude, id: :longitude %>
  <%= f.text_field :latitude, id: :latitude %>
  <div class="form-group">
  <%=f.submit :submit , class:"btn btn-primary" %>
  </div>
 <% end%>
<div>
</div>

<script>
  $('#upload-btn').click(function(e){
    e.preventDefault();
    document.getElementById('upload_imgs').click()
  })
  var imgUpload = document.getElementById('upload_imgs')
  , imgPreview = document.getElementById('img_preview')
  , imgUploadForm = document.getElementById('img-upload-form')
  , totalFiles
  , previewTitle
  , previewTitleText
  , img;
  var img_id = 0;
imgUpload.addEventListener('change', previewImgs, false);

function previewImgs(event) {
  totalFiles = imgUpload.files.length;
  for(var i = 0; i < totalFiles; i++) {
    const img = document.createElement('img');
    img.onload = function(){
      var width = this.width;
      var height = this.height;
      if(width<200 || height<200){
        alert("image not permittable")
        return false
      }
      imgPreview.classList.remove('quote-imgs-thumbs--hidden');
      var input=document.createElement('input');
      input.type="file";
      input.multiple = true;
      input.hidden = true;
      input.name = 'car_images[]';
      input.files = imgUpload.files
      var img_wrap = document.createElement('div')
      img_wrap.className += "upload_img"
      img_wrap.id = "upload"+img_id;

      img_wrap.style.cssText = "position:relative;width:200px;height:200px;padding:5px;"
      var img_content = document.createElement('div')
      img_content.style.cssText ="padding:5px;background-color:white;"
      var remove_icon = document.createElement('i')
      remove_icon.className += "fa fa-trash"
      remove_icon.onclick = function(){
        if(document.getElementsByClassName('upload_img').length == 1){
          imgPreview.classList.add('quote-imgs-thumbs--hidden');
          img_wrap.remove();
        }else{
          img_wrap.remove();
        }
      }
      remove_icon.style.cssText = "position:absolute;right:0;bottom:0; padding:8px;"
      img.style.cssText = "width:100%;height:185px;"
      img_content.appendChild(img)
      img_content.appendChild(remove_icon)
      img_wrap.appendChild(img_content)
      img_wrap.appendChild(input);
      document.getElementById("img_preview").appendChild(img_wrap)
      img_id += 1
      return true
    }
    img.src = URL.createObjectURL(event.target.files[i]);
  }

}
$(document).ready(
  function(){
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(showPosition)
    }
    function showPosition(position){
      $('#latitude').val(position.coords.latitude)
      $('#longitude').val(position.coords.longitude)
    }
  }
)
</script>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyBiIXz9vSrc6ueSxsIxF-zVhLw3Wg7qy5A&libraries=places"></script>
   <script>
    function initialize() {
      var input = document.getElementById('location');
      var autocomplete = new google.maps.places.Autocomplete(input);
      google.maps.event.addListener(autocomplete, 'place_changed', function () {
      var place = autocomplete.getPlace();
      document.getElementById('city2').value = place.name;
      document.getElementById('cityLat').value = place.geometry.location.lat();
      document.getElementById('cityLan').value = place.geometry.location.lng();
      });
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>