<style>
.quote-imgs-thumbs {
  background: #eee;
  border: 1px solid #ccc;
  border-radius: 0.25rem;
  margin: 1.5rem 0;
  padding: 0.75rem;
  display: flex;
}
.fa-trash:hover{
  color:red;
  cursor:pointer;
}
.quote-imgs-thumbs--hidden {
  display: none;
}
.img-preview-thumb {
  background: #fff;
  border: 1px solid #777;
  border-radius: 0.25rem;
  box-shadow: 0.125rem 0.125rem 0.0625rem rgba(0, 0, 0, 0.12);
  margin-right: 1rem;
  max-width: 140px;
  padding: 0.25rem;
}
</style>
<div class="container">
<nav class="car-details p-4">
<div><a class="p-3"></a></div>
</nav>
<div>
 <%=form_with url: create_seller_appointment_path, id: "car-details", method: :post  do |f|%>
  <%=f.text_field :user_id, value: current_user.id, hidden: "true"%>
  
  <div class="form-group">
  <%=f.label 'choose the brand'%>
  <%= select_tag(:brand_id, options_for_select(@brands), class:"custom-select custom-select-lg mb-3", id: "brand", include_blank: '--selecr your brand--') %>
  </div>

  <div class="form-group">
  <%=f.label 'choose the model'%>
  <%=select_tag(:car_model_id, options_for_select('<option></option>'), class:"custom-select custom-select-lg mb-3", id:"car-model") %>
  </div>

  <div class="form-group">
  <%=f.label 'choose the range'%>
  <%=select_tag(:killometer_driven_id, options_for_select(@killometer_drivens), class:"custom-select custom-select-lg mb-3", id:'killometer-driven') %>
  </div> 

  <div class="form-group">
  <%=f.label 'choose the registered state code'%>
  <%=select_tag(:car_registration_id, options_for_select(@car_registrations), class:"custom-select custom-select-lg mb-3", id:"car-registration", required: true) %>
  </div>

  <div class="form-group">
  <%=f.label 'choose the type'%>
  <%=select_tag(:car_variant_id, options_for_select(@car_variants), class:"custom-select custom-select-lg mb-3", id: "car-variant", required: true) %>
  </div>

  <div class="form-group">
   <%=f.label "description"%>
   <%=f.text_area :description, class:"form-control", id: "description"%>
  </div>

  <div class="form-group field">
   <%=f.label "expected price"%>
   <%=f.number_field :price ,required: true, class: "form-control", id: "expected-price", required: true %>
  </div>

  <div class="form-group">
    <%= f.label 'currency' %>
    <%=select_tag(:currency, options_for_select([['INR','â‚¹'],['USD','$']]), class:"custom-select custom-select-lg mb-3") %>        
  </div>

  <div class="form-group field">
    <%=f.label "year of buy"%>
    <%=select_tag(:year_of_buy, options_for_select(@years), class:"custom-select custom-select-lg mb-3", id:"year", required: true) %>
   </div>

  <div class="form-group">
    <%=f.label "seller's country" %>
    <%=select_tag(:country_id, options_for_select(@countries), class:"custom-select custom-select-lg mb-3", id:"country", include_blank: '--selecr your country--') %>
  </div>
  
  <div class="form-group">
    <%=f.label 'choose your state'%>
    <%=select_tag(:state_id, options_for_select('<option></option>'), class:"custom-select custom-select-lg mb-3", id:"state") %>
  </div>

  <div class="form-group">
    <%=f.label 'choose your city'%>
    <%=select_tag(:city_id, options_for_select('<option></option>'), class:"custom-select custom-select-lg mb-3", id:"city") %>
  </div>

  <div class="form-group">
    <%=f.label 'zip code' %>
    <%=f.text_field :zip_code, id: "zip-code", class: "form-control"%>
  </div>

  <div class="form-group field" id="uio">
  <%=f.file_field :upload_imgs, id: "upload_imgs", multiple: true, name: 'images[]', class:"show-for-sr", hidden: true%>
  <button class="btn btn-primary" id="upload-btn">add images<i class="fa fa-plus"></i></button>
  </div>
  <div class="quote-imgs-thumbs quote-imgs-thumbs--hidden" id="img_preview" aria-live="polite"></div>
  </div>

  <%= f.text_field :longitude, id: 'longitude', type: "hidden" %>
  <%= f.text_field :latitude, id: 'latitude', type: "hidden" %>
  <div class="form-group">
  <%=f.submit :submit , class:"btn btn-primary" %>
  </div>
 <% end%>
<div>
</div>
<%= render 'layouts/helper_address' %>

<script>

  $("#car-details").submit(
    function(e){
      var b = $('#brand').val()
      var cm = $('#car-model').val()
      var kd = $("#killometer-driven").val()
      var cr = $("#car-registration").val()
      var cv = $("#car-variant").val()
      var d = $("#description").val()
      var ep = $("#expected-price").val()
      var c = $("#country").val()
      var st = $("#state").val()
      var ci = $("#city").val()
      console.log($('#year').val())
      var y = $('#year').val()
      var f = $('#upload_imgs').prop('files').length
      var zip_code = $('#zip-code').val()
      console.log(b)
      console.log(cm)
      console.log(kd)
      console.log(cr)
      console.log(cv)
      console.log(d)
      console.log(ep)
      console.log(c)
      console.log(st)
      console.log(ci)
      console.log(f)
      console.log(y)
      console.log(zip_code)
      if(b && cm && kd && cr && cv && d && ep && c && st && ci && f && y && zip_code){
        console.log("pop0")
        return true
      }else{
        console.log("pop")
        e.preventDefault();
        return false
      }

    }
  )
   $("#brand").change(
      function(){
        var p = $("#brand").val();
        if(!p){
          $("#car-model").html("");
          return;
        }
        console.log(p);
        $.ajax(
          {
            type: 'get',
            url: '<%= ws_get_car_models_path %>',
            dataType: 'json',
            contentType: 'application/json',
            data: {
              brand_id : $("#brand").val()  
            },
            success: function(res){
              console.log(res)
              $('#car-model').html(res.html)
            },
            error: function(err){

            }
          }
        )

      }

    )
  $('#upload-btn').click(function(e){
    e.preventDefault();
    document.getElementById('upload_imgs').click()
  })
  var imgUpload = document.getElementById('upload_imgs')
  , imgPreview = document.getElementById('img_preview')
  , imgUploadForm = document.getElementById('img-upload-form')
  , totalFiles
  , previewTitle
  , previewTitleText
  , img;
  var img_id = 0;
imgUpload.addEventListener('change', previewImgs, false);

function previewImgs(event) {
  totalFiles = imgUpload.files.length;
  for(var i = 0; i < totalFiles; i++) {
    const img = document.createElement('img');
    img.onload = function(){
      var width = this.width;
      var height = this.height;
      if(width<200 || height<200){
        alert("image not permittable")
        return false
      }
      imgPreview.classList.remove('quote-imgs-thumbs--hidden');
      var input=document.createElement('input');
      input.type="file";
      input.multiple = true;
      input.hidden = true;
      input.name = 'car_images[]';
      input.files = imgUpload.files
      var img_wrap = document.createElement('div')
      img_wrap.className += "upload_img"
      img_wrap.id = "upload"+img_id;

      img_wrap.style.cssText = "position:relative;width:200px;height:200px;padding:5px;"
      var img_content = document.createElement('div')
      img_content.style.cssText ="padding:5px;background-color:white;"
      var remove_icon_wrap = document.createElement('div')
      remove_icon_wrap.className += "remove-warp"
      var remove_icon = document.createElement('i')
      remove_icon.className += "fa fa-trash"
      remove_icon.onclick = function(){
        if(document.getElementsByClassName('upload_img').length == 1){
          imgPreview.classList.add('quote-imgs-thumbs--hidden');
          img_wrap.remove();
        }else{
          img_wrap.remove();
        }
      }
      remove_icon_wrap.style.cssText =  "position:absolute;bottom:0; padding:8px; background-color:white"
      img.style.cssText = "width:100%;height:185px;"
      remove_icon_wrap.appendChild(remove_icon)
      img_content.appendChild(img)
      img_content.appendChild(remove_icon_wrap)
      img_wrap.appendChild(img_content)
      img_wrap.appendChild(input);
      document.getElementById("img_preview").appendChild(img_wrap)
      img_id += 1
      return true
    }
    img.src = URL.createObjectURL(event.target.files[i]);
  }

}
$("#year").change(function(){
  console.log($('#year').val())
})
$(document).ready(
  function(){
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(showPosition)
    }
    function showPosition(position){
      $('#latitude').val(position.coords.latitude)
      $('#longitude').val(position.coords.longitude)
    }
  }
)
</script>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyBiIXz9vSrc6ueSxsIxF-zVhLw3Wg7qy5A&libraries=places"></script>
   <script>
    function initialize() {
      var input = document.getElementById('location');
      var autocomplete = new google.maps.places.Autocomplete(input);
      google.maps.event.addListener(autocomplete, 'place_changed', function () {
      var place = autocomplete.getPlace();
      document.getElementById('city2').value = place.name;
      document.getElementById('cityLat').value = place.geometry.location.lat();
      document.getElementById('cityLan').value = place.geometry.location.lng();
      });
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>